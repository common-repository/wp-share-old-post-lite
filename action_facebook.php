<?php//FACEBOOK PUBLISHERrequire_once 'fonctions.php';function sop_facebook_ommitposts(){    }function sop_facebook_options() {    if (!current_user_can('manage_options')) {        wp_die(__('You do not have sufficient permissions to access this page.'));    }    $wp_categories=get_categories();        //Save settings    if(isset($_POST['save']))    {        $minIntervalBtPost=$_POST['minIntervalBtPost'];        $minAgePost=$_POST['minAgePost'];        $maxAgePost=$_POST['maxAgePost'];        $nbOfPost=$_POST['nbOfPost'];        $ListExcludedCategory=array();        foreach ($wp_categories as $category) {            if($_POST['category'.$category->term_id])                $ListExcludedCategory[]=$_POST['category'.$category->term_id];        }                $dataSave=array(            "minIntervalBtPost" => $minIntervalBtPost,            "minAgePost" => $minAgePost,            "maxAgePost" => $maxAgePost,            "nbOfPost" => $nbOfPost,            "excludedCategories" => implode(",",$ListExcludedCategory),        );        sop_save_facebook_settings($dataSave);        echo '<div id="message" class="updated below-h2"><p>';        ___("settings saved succefully");        echo '</p> </div><br>';    }            //Start sharing    elseif(isset($_POST['share'])){         sop_wsClient("checkListShareFb",array());         echo '<div id="message" class="updated below-h2"><p>Publishing was done succefully</p> </div><br>';    }    //Save settings    elseif(isset($_POST['reset'])){        try{                    sop_get_initial_facebook_settings();                echo '<div id="message" class="updated below-h2"><p>Settings was reset succefully</p> </div><br>';        }        catch(Exception $exc){            echo '<div class="error"><p>Cannot load initial settings, maybe the file ./facebook_initial.json was deleted ! </p></div><br>';        }    }    elseif(isset($_POST['stateSharing'])){        $state=$_POST['stateSharing'];        if($state==="true")            $stateChecked='checked="checked"';        else            $stateChecked='';        sop_set_sharing_state("fb",$state);    }    if(!$data)    {        $data=sop_get_facebook_settings();        $state=$data['state'];        if($state)            $stateChecked='checked="checked"';        else            $stateChecked='';             $minIntervalBtPost=$data['minIntervalBtPost'];        $minAgePost=$data['minAgePost'];        $maxAgePost=$data['maxAgePost'];        $nbOfPost=$data['nbOfPost'];        $category=$_POST['category'];        $ListExcludedCategory=array();        foreach ($wp_categories as $category) {            if(in_array($category->term_id, explode(",",$data['excludedCategories']),1))                $ListExcludedCategory[]=$category->term_id;        }    }                ?><img src="<?php echo plugins_url(); ?>/wp-share-old-post-lite/img/WP-ShareOld_PagesPlugin.png"><br><a style="text-decoration: none" href="http://www.shareoldpost.com/shop/share-old-post-for-wordpress">    <img src="<?php echo plugins_url(); ?>/wp-share-old-post-lite/img/Bouton_LiteSOP.png"></a><link rel="stylesheet" href="<?php echo plugins_url(); ?>/wp-share-old-post-lite/css/onoff.css" type="text/css" media="screen"><script src="<?php echo plugins_url(); ?>/wp-share-old-post-lite/js/manage_counts.js"></script><form method="post" name="sop_form_state_sharing">    <input name="stateSharing" type="hidden" id="stateSharing"></form>   <div style="padding: 20px">             <div class="settings" style="float: left; width: 230px" >                <p>                    <input type="checkbox" <?php echo $stateChecked; ?> onchange="changeStatusSharing(checked)" class="checkalist"  id="1" name="1" />                              <label class="check" for="1"></label>                              <label class="info" id="stateFbsharing"><?php ___("share on facebook"); ?></label>                        </p>            </div>       <div style="padding-top: 7px">            <input type="button" value="<?php echo ___('manage facebook counts'); ?>" class="button button-primary" onClick="open_manager_window('<?php echo shortClientURL; ?>');">&nbsp;   </div>       </div><div style="padding: 20px">                    <form method="post">    <table>        <tr>            <td align="right">                <?php ___("minIntervalBtPost"); ?>            </td>            <td>&nbsp;</td>            <td>                <select name="minIntervalBtPost">                    <option value="12">12</option>                </select>            </td>        </tr>        <tr>            <td colspan="2" >                            </td>            <td style="padding-bottom: 5px;font-size:12px;height: 17px;vertical-align: top">                <?php ___("minIntervalBtPost desc"); ?>                <br>                <span style="color:red">(Only for Premium version)</span>            </td>        </tr>                        <tr>            <td align="right">                <?php ___("minAgePost"); ?>            </td>            <td>&nbsp;</td>            <td>                <input type="text" name="minAgePost" value="<?php echo $minAgePost; ?>">            </td>        </tr>        <tr>            <td colspan="2" >                            </td>            <td style="padding-bottom: 5px;font-size:12px;height: 17px;vertical-align: top">                <?php ___("minAgePost desc"); ?>            </td>        </tr>                                <tr>            <td align="right">                <?php ___("maxAgePost"); ?>            </td>            <td>&nbsp;</td>            <td>                <input type="text" name="maxAgePost" value="<?php echo $maxAgePost; ?>">            </td>        </tr>        <tr>            <td colspan="2" >                            </td>            <td style="padding-bottom: 5px;font-size:12px;height: 17px;vertical-align: top">                <?php ___("maxAgePost desc"); ?>            </td>        </tr>                        <tr>            <td align="right">                <?php ___("nbOfPost"); ?>            </td>            <td>&nbsp;</td>            <td>                <select name="nbOfPost">                    <option value="1">01</option>                </select>            </td>        </tr>        <tr>            <td colspan="2" >                            </td>            <td style="padding-bottom: 5px;font-size:12px;height: 17px;vertical-align: top">                <?php ___("nbOfPost desc"); ?>                <br>                <span style="color:red">(Only for Premium version)</span>            </td>        </tr>                        <tr>            <td align="right" nowrap="nowrap">                <?php ___("categories to Omit");                 ?>            </td>            <td></td>            <td style="font-size:12px;">                <?php ___("categories to Omit desc"); ?>                            </td>        </tr>                <tr>            <td align="right">                            </td>            <td></td>            <td >                                <?php                 sop_print_categoriescheckbox_by_parent_id(0,$ListExcludedCategory);                ?>                            </td>        </tr>                                        <tr>            <td colspan="3">&nbsp;</td>        </tr>        <tr>            <td align="left" colspan="3">                <input type="submit" value="<?php ___('save settings'); ?>" class="button button-primary"  name="save">&nbsp;                <input type="submit" value="<?php ___('share now'); ?>" class="button button-primary" id="submit" name="share">&nbsp;                <input type="submit" value="<?php ___('reset settings'); ?>" class="button button-primary" id="submit" name="reset">&nbsp;                                <a style="text-decoration: none" href="http://www.shareoldpost.com/shop/share-old-post-for-wordpress"><input type="button" value="<?php ___('Up to Premium'); ?>" class="button button-primary" style="background: #09B70B !important" id="submit" name="reset">&nbsp;                </a>            </td>        </tr>    </table></form></div>    <?php}function sop_save_facebook_settings($data){    sop_wsClient("saveFacebookSetting",$data);        }function sop_get_facebook_settings(){    $a= json_decode(sop_wsClient("getFacebookSetting"),1);    if(!$a)    {        return sop_get_initial_facebook_settings();    }    return $a;    }    function sop_get_initial_facebook_settings(){    $initialDataSetting=array(        'minIntervalBtPost' => 1,        'minAgePost' => 0,        'maxAgePost' => 0,        'nbOfPost' => 1,        'excludedCategories' => ''    );    sop_save_facebook_settings($initialDataSetting);    return $initialDataSetting;    }  ?>